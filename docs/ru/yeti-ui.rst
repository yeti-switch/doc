Contents:

.. toctree::
    :maxdepth: 3

==================
Веб-интерфейс YETI
==================

:Сайт: https://yeti-switch.org/
В связи с тем, что веб-интерфейс в данный момент не переведен на русский язык, названия параметров приведены на английском языке, а определения на русском.

.. Примечание::

    Данные авторизации по-умолчанию для входа в веб-интерфейс послеу установки приложения:

    - *логин*: **admin**, 
    - *пароль*: **111111**

Объекты конфигурации
=====================

Панель мониторинга
---------
Отображает различные индикаторы состояния системы, такие как:

- график активных звонков
- прибыльность и продолжительность звонков
- статус биллинга
- состояние репликации базы данных

Billing. Contractors
--------------------
Contractor(Контрагент):
    Компания, которая взаимодействует с системой

Контрагент может выступать в ролях:

    Customer (Покупатель)
        Использует предоставляемый сервис по терминации звнков.
    Supplier (Поставщик)
        Предоставляет сервис по терминации звонков.

Конрагент может являться Покупателем и/или Поставщиком

**Contractor** имеет следующие атрибуты:

    Name
        Уникальный идентификатор имени.
    Enabled
        Если флаг снят (контрагент отключен), этот контрагент не будет использоваться при роутинге и биллинге.
    Vendor
        Если активировано, то данный Контрагент выступает в роли Поставщика и система может терминировать звонки через него.
    Customer
        Если активировано, то Контрагент выступает в роли Покупателя и оригинирует звонки в систему.
    Description
        Дополнительное описание Контрагента.
    Address
        Произвольный адрес Контрагента.
    Phones
        Список номеров для связи с Контрагентом.
    Smtp Connection
        Соединение с сервером электронной почты, используемое для отправки писем, счетов и уведомлений.
        (SMTP соединение предварительно должно быть настроено в *System->SMTP connections*)

.. Примечание:: Поля **Description**, **Address**, **Phones** информационные и не используются на этапе роутинга или биллинга.

Billing. Contacts
-----------------
Contact:
    Адресная информация о Контрагенте или операторе системы (контакт может быть отнесен к Контрагенту или оператору системы)
	Все уведомления и отчеты используют только те адреса, которые добавлены в контакты.
	
**Contact** имеет следующие атрибуты:

    Contractors:
        Список выбора Контрагентов, к которым может быть отнесен контакт.
    Admin user:
        Администратор системы, которому может быть присвоен контакт.
		Названия Контрагентов или имя Администратора системы должно быть введено.		
    E-mail:
        Адрес электронной почты для отправки уведомлений, счетов и прочих писем.
    Notes:
        Произвольные заметки

Billing. Accounts
-----------------

**Account** атрибуты:

    Name
        Уникальное название Счета
    Contractors
        Контрагенты которомы принадлежит данный Счет.
    Min balance
        Если баланс Счета становится ниже чем данный лимит, то трафик через данный Счет будет заблокирован.
    Max balance
        Если баланс Счета станет выше чем данный лимит, то маршруты относящиеся к данному Счету не будут использованы для терминации звонков.
    Origination capacity
        Ёмкость оригинации - количество одновременных звонков, которое может быть оригинировано для данного Счета.
        Если количество входящих звонков превысит данную ёмкость, то трафик будет заблокирован.
    Termination capacity
        Ёмкость терминации - количество одновременных звонков, которое может быть терминировано для данного Счета.
        Если количество исходящих звонков превысит данную ёмкость, то трафик будет заблокирован.
    Vendor invoice period
        Период автоматической генерации счетов, в случае, если Счет выступает в роли счета Поставщика.
    Customer invoice period
	    Период автоматической генерации счетов, в случае, если Счет выступает в роли счета Покупателя.
    Vendor invoice template
	    Шаблон для генерации счетов в формате PDF для Поставщика.
        (Шаблоны предварительно должны быть настроены в *Billing->Invoice templates*)
    Customer invoice template
	    Шаблон для генерации счетов в формате PDF для Покупателя.
        (Шаблоны предварительно должны быть настроены в *Billing->Invoice templates*)
    Sent invoices to
        Список Контактов, для отправки счетов.
    Timezone
        Временная зона, которая будет использована при генерации счетов и статистики для данного Счета.

Исходный баланс для вновь созданного Счета всегда нулевой.
Баланс может быть изменен, как результат обсчета звонков или при зачислении новых платежей.

Для каждого звонка:
баланс Счета будет **уменьшен** на величину стоимости звонка, если он использует Счет для **оригинации** (Покупатель)
и **увеличен** если он использует Сче для **терминации** (Поставщик)

Billing. Payments
-----------------

Платежи предназначены для изменения баланса Счета.
Все атрибуты Платежей самоописательные и не требуют детальных разъяснений (Счет для зачисления Платежа, сумма, описание и дата Платежа).

Billing. Invoices
-----------------
Счета на оплату обеспечивают возможность ссумировать биллинговую информацию о взаиморасчетах с Покупателями и Поставщиками.
Генерация Счетов на оплату может производиться в ручном или автоматическом режиме, если период авторегенерации для Счета был выбран.
Новые счета на оплату создаются со статусом *В ожидании (Pending)*
После *Одобрения* Cчет на оплату считается подтвержденным и отправленным Контрагенту на электронную почту (настраиваетя в параметрах Счета).
Если Счет имеет Шаблон Счета на оплату, система также сгенерирует PDF документ.

Billing. Invoice Templates
--------------------------
Шаблоны PDF документов могут быть использованы для генерации Счетов на оплату.
Шаблон представляет собой файл в формате .odt, который содержит специальные макросы для вставки значений.
Макросы заменяются на актуальные значение на этапе генерации PDF документа.
Система может хранить различные Шаблоны, и пользователь может выбирать необходимый для каждого Счета независимо.

Equipment. Gateways
-------------------

**Gateway** атрибуты:
    Enabled
        Отключенный Гейтвей будет игнороваться 
    Gateway group
	    Гейтвеи могут быть сгруппированы.
		Выберите заранее созданную группу в списке, для того чтобы назначить в неё Гейтвей.
        Управление Группами гейтвеев осуществляется в *Billing->Gateway Groups*
    Priority
	    Приоритет Гейтвея в группе.
		В случае терминации на Группу гейтвеев, Гейтвеи будут выстроены в оередь по данному приоритету.
    Pop
        Точка присутствия Гейтвея
    Contractor
	    Контрагент, которому принадлежит данный Гейтвей.
    Allow origination
	    Указывает, разрешена ли оригинация для данного Гейтвея
    Allow termination
	    Указывает, разрешена ли терминация для данного Гейтвея с YETI
    Sst enabled
	    Принудительное использование таймеров сессии SIP, в противном случае таймеры будут контролироваться сигнализацией удаленной стороны.
    Capacity
	    Ёмкость терминации для данного Гейтвея. В случае, если Гейтвей используется для оригинации, данный арибут игнорируется.
    Acd limit
	    Пороговое значение ACD. Если ACD для трафика Гейтвея будет ниже порога, то Диалпиры, которые используются этим Гейтвеем,
		будут исключены из роутинга, в случае, если выбран режим **ACD&ASR control** для Плана маршрутизации.
    Asr limit
	    Пороговое значение ASR. Если ASR для трафика Гейтвея будет ниже порога, то Диалпиры, которые используются этим Гейтвеем,
		будут исключены из роутинга, в случае, если выбран режим **ACD&ASR control** для Плана маршрутизации.
    Sensor
        Сенсор для зеркалирования трафика. Зеркалирование отключено, если ничего не установлено.
    Sensor level
	    Режим зеркалирования трафика. Возможные значения:

            - Signaling (Сигнализация)
            - RTP
            - Signaling + RTP
    Host
        IP-адрес или DNS-имя удаленного Гейтвея для отправки на него SIP сигнализации.
        (используется только для терминации)
    Port
	    Порт удаленного Гейтвея для отправки на него SIP сигнализации.
        Оставьте его пустым для активации режима определения имени по записям DNS SRV в **Host**
    Resolve ruri
	    Активирует определение RURI.
		Определяет необходимость в изменении доменной части RURI на определенный IP-адрес
       
        например: `domain.com` имеет IP 1.1.1.1 и вы устанавливаете значение **Host** в `domain.com`:

            - resolve ruri активирована => RURI будет `user@1.1.1.1`
            - resolve ruri выключена => RURI будет `user@domain.com`
    Diversion policy
	    Политика обработки заголовка Diversion в SIP-сигнализации        
    Diversion rewrite rule
	    Шаблон регулярного выражения для поиска соответствия в поле Diversion
    Diversion rewrite result
	    Регулярное выражение замены для поля Diversion
    Src name rewrite rule
	    Шаблон регулярного выражения для поиска в части display-name поля From
    Src name rewrite result
	    Регулярное выражение замены в части display-name поля From
    Src rewrite rule
	    Шаблон регулярного выражения для поиска в части user поля From
    Src rewrite result
	    Регулярное выражение замены в части user поля From
    Dst rewrite rule
	    Шаблон регулярного выражения для поиска в части user поля To и RURI
    Dst rewrite result
	    Регулярное выражение замены в части user поля To и RURI
    Auth enabled
	    Активация авторизации для исходящих звонков
    Auth user
	    Пользователь авторизации
    Auth password
	    Пароль для авторизации
    Auth from user
	    Часть user поля From для проведения авторизации
    Auth from domain
	    Часть domain поля From для проведения авторизации
    Term use outbound proxy
	    Использовать исходящий прокси для терминации
    Term force outbound proxy
	    Принудительное использование исходящего прокси для терминации
    Term outbound proxy
	    Адрес исходящего прокси
    Term next hop for replies
        ..
    Term next hop
        ..
    Term disconnect policy
        ..
    Term append headers req
	    Список полей, которые будут добавлены в **НАЧАЛЬНЫЙ** INVITE
    Sdp alines filter type
	    Тип фильтра для обработки А-линий в SDP. Возможные значения: Transparent, Blacklist, Whitelist
    Sdp alines filter list
        Список А-линий в SDP, разделенных запятыми.

    .. _gateway_ringing_timeout:

    Ringing timeout
        Таймаут между ответами `18x` и `200 OK`. 

        В случае таймаута: попытка роутинга будет отменена
        и дальнейшая обработка (пытаться перероутиться или больше не пытаться) зависит от политики отбоя (disconnect policy).
    Relay options
	    Прозрачно пересылать внутридиалоговые (In-dialog) пакеты OPTIONS между легами звонка.
    Relay reinvite
	    Прозрачно пересылать внудридиалоговые (In-dialog) сообщения re-INVITE между легами звонка.
    Relay hold
	    Прозрачно пересылать внутридиалоговые (In-dialog) сообщения re-INVITE с запросами на удержанием/снятие удержания между легами звонка.
    Relay prack
	    Прозрачно пересылать внудридиалоговые (In-dialog) сообщения PRACK между легами звонка.
    Relay UPDATE
	    Прозрачно пересылать сообщения UPDATE между легами звонка.
    Suppress early media
	    Подавление раннего медиа.
        Отсылать 180 Ringing сообщения без SDP на LegA при получении 180/183 с SDP от LegB гейтвея.
    Transit headers from origination
        Фильтр заголовков SIP запросов, который будет применяться при фильтрации заголовков, отправленных оригинатором звонка. Подробнее в приложении :ref:`headers filtering <headers_fitering>`
    Transit headers from termination
        Фильтр заголовков SIP запросов, который будет применяться при фильтрации заголовков, отправленных терминационной стороной. Подробнее в приложении :ref:`headers filtering <headers_fitering>`
    Allow 1xx without to tag
	    Позволяет пропускать ответы с кодом 1хх без To-tag (однако данное поведение нарушает RFC).
    Sip timer B
	    Перезаписывает значение SIP timer B (таймаут транзакции).
		Звонок может быть повторно перероучен, если это позволяется политикой отбоя конфигурации.
    Dns srv failover timer
	    Перезаписывает значение SIP timer M (повторная отправка INVITE). Значение должно быть меньше значения **SIP timer B**.
        Звонок может быть повторно перероучен, если это позволяется политикой отбоя конфигурации.
    Sdp c location
	    Положение connection-line в теле SDP, которое генерируется YETI.
        Возможные значения:

            - На уровне медиа (On media level)
            - На уровне сессии (On session level)
            - На уровне медиа и сессии (On session and media level)
    Codec group
	    Группа кодеков, которая будет использована при взаимодействии с данным гейтвеем.
    Anonymize sdp
		Анонимизировать данные клиентской SDP сессии (session name, uri, origin user)
    Proxy media
		Определять режим обработки RTP. Должно быть активировано для возможностей транскодирования.
    Single codec in 200ok
		Если активировано, YETI оставит только один кодек в ответах с SDP (исключая telephone-event
        который все равно будет добавлен, если получен в предложении SDP и присутствует в кодек-группе
        для этого гейтвея).
    Transparent seqno
		Прозрачная пересылка номера RTP SEQ при передаче RTP.
    Transparent ssrc
	    Прозрачная пересылка номера RTP SSRC при передаче RTP.
    Force symmetric rtp
		Игнорировать удаленный адрес указанный в SDP.
		Вместо этого использовать адрес, с которого получен первый RTP/RTCP пакет.
    Symmetric rtp nonstop
	    По-умолчанию, YETI позволяет изменять адрес для симметричного RTP только один раз.
		Эта опция позволяет снять данное ограничение.
		Если она активна, YETI будет изменять адрес назначение каждый раз, когда получае RTP/RTCP пакет с другого источника.
    Symmetric rtp ignore rtcp
		Отключает симметричный RTP для RTCP пакетов.
    Force dtmf relay
		Не обрабатывать telephone-event (RFC2833) пакеты и пересылать их "как есть".
    Dtmf send mode
		Режим отправки DTMF на удаленный гейтвей. Возможные значения:

            - Отключить отправку (Disable sending)
            - RFC 2833 (telephone-event)
            - SIP INFO application/dtmf-relay
            - SIP INFO application/dtmf
    Dtmf receive mode
		Разрешенные методы получения DTMF-сигналов с удаленного гейтвея. В случае, если это запрещено, они будут игнорироваться.
        Возможные значения:

            - RFC 2833 (telephone-event)
            - SIP INFO application/dtmf-relay OR application/dtmf
            - RFC 2833 OR SIP INFO
    Rtp ping
		Полезная опция для следующего случая: когда гейтвеи со включенным симметричным RTP ожидают первого пакета, прежде чем начинать передачу,
		но гейтвей на удаленно стороне делает тоже самое,
		Если опция активирована, YETI отправляет фиктивный RTP пакет на удаленный гейтвей сразу же после инициализации потока.
    Rtp timeout
	    Если активирована, звонок будет сброшен с соответствующим кодом в CDR, если никакой RTP не поступил в течение указанного интервала.
    Filter noaudio streams
	    Исключать все потоки кроме 'audio' из SDP в INVITE для терминационного гейтвея.
		Данные не-аудио потоки будут автоматически вставлены как отключенные (порт установлен в ноль)
		в ответы гейтвею, который отправил предложение для соответствия RFC.
		Полезно для гейтвеев, которые обрабатывают множественные потоки в SDP некорректно и/или отклюняют INVITEs с не-аудио потоками.
    Rtp relay timestamp aligning
		Нормализация временных меток для RTP-пакетов при передаче RTP.
		Полезно в случаях, когда при передаче RTP удаленная сторона изменяет RTP-потоки
		без соответствующей сигнализации (отметка RTP и/или re-INVITE) и оборудование
		не готово обрабатывать такое поведение корректно. 
    Rtp force relay CN
		Если активирована, YETI будет пересылать CN-пакеты, даже если они не были согласованы в SDP.

Equipment. Gateway groups
-------------------------
Группы гейтвеев позволяют использовать множество гейтвеев терминации трафика для одного Поставщика,
если данные гейтвеи имеют общую конфигурацию биллинга.

**Gateway group** атрибуты:

    Name
		Уникальное название группы
    Vendor
	    Поставщик, к которому относится данная группа
    Prefer same pop
		Если активирована, первоначально использовать терминационные гейтвеи с той же самой POP, что и входящий трафик.

Equipment. Disconnect policies
------------------------------
Политика отбоя позволяет настраивать правила для каждого SIP-кода разъединения для гейтвея (рероутинг, перезапись кодов/причин).

Equipment. Registrations
------------------------
YETI предоставляет возможность регистрировать на внешних SIP-серверах.

**Registration** атрибуты:

    Enabled
	    Активирует регистрацию. Отключенные регистрации игнорируются.
    Pop
		Точка присутствия (PoP) для запросов на регистрацию. Из данной точки будут отправляться запросы REGISTER.
    Node
		Нода, которая обслуживает регистрацию.
    Domain
		Доменная часть поля From в RURI.
    Username
	    Пользовательская часть поля From в RURI.
    Display username
		Отображаемое имя в поле From.
    Auth user
		Имя пользователя для авторизации.
    Auth password
		Пароль для авторизации.
    Proxy
		SIP-прокси используемый для регистрации.
    Contact
		Заголовок Contact в запросе.
    Expire
		Время истечения регистрации.
    Force expire
		Принудительная перерегистрация после истечения интервавала **Expire**, даже если сервер установил иное значение в ответе.

Equipment. Codec groups
-----------------------
Группы кодеков позволяют создавать произвольные наборы медиа-кодеков и применять их к гейтвеям. Группы могут различаться по составу кодеков,
их приоритету и кодам нагрузки, что позволяет обрабаывать различные сценарии при обработке звонков.

**Codec group** атрибуты:

    Name
		Название Группы кодеков
    List of codecs
		Каждый кодек имеет следующие атрибуты:

            Codec
				Название кодека. Все доступные кодеки представлены в выпадающем списке
            Priority
				Приоритет кодека в SDP. Меньшее значение означает более высокий приоритет.
				Должен быть уникален в пределах группы.
            Dynamic payload type
			    Перезапись типа нагрузки (разрешены значения из динамического диапазона)
            Format parameters
				Нестандартное значение для параметра **fmt** в атрибуте SDP.
                
Equipment. LNP database
-----------------------
Смотри https://en.wikipedia.org/wiki/Local_number_portability

YETI поддерживает взаимодействие с базами данных LNP по протоколам SIP и HTTP REST.
Команда YETI приветствует запросы на реализацию дополнительных протоколов или баз данных иных форматов!

Name
	Название базы данных (Уникальное поле)
Driver
	Драйвер, который будет использоваться. 
	Возможные варианты:

        - UDP SIP 301/302 redirect
        - thinQ RESR LRN driver
        - In-memory hash
Host
	Адрес базы данных (будет проигнорирован при использовании драйвера In-memory hash).
Port
	Порт базы данных.
Timeout
	Максимальное время ожидания ответа от базы даннных.
	Запрос будет признан неуспешным с соответствующим кодом и причиной.
Thinq username
	Имя пользователя для авторизации в thinQ API.
Thinq token
	Токен авторизации в thinQ API.
Csv file
	Путь к файлу с предзагруженными данными (при использовании драйвера In-memory hash)
    
Equipment. RADIUS Auth Profiles
-------------------------------
YETI поддерживает дополнительную авторизацию входящего звонка на внешнем RADIUS сервере. RADIUS Auth Profile описывает взаимодействие с таким сервером.

**RADIUS Auth Profiles** атрибуты:

Name
    Название профайла. Используется только как информационное поле и не влияет на работу системы. Название профайла должно быть уникально.
Server
    IP адрес или Hostname внешнего RADIUS сервера
Port
    Номер UDP порта, на котором RADIUS сервер ожидает запросы
Secret
    Пароль для авторизации RADIUS сервера.
Reject on error
    Если флаг установлен в true то при ошибке взаимодействия с радиус сервером(таймаут, неверный формат ответа), звонок будет считаться авторизованым и YETI будет выполнять дальнейшую его маршрутизацию. Если флаг установлен в false - при ошибке звонок будет разъединяться с соответствующим кодом разъединения
Timeout
    Таймаут, по истечении заданного кол-ва миллисекунд будет выполняться повтор радиус запроса
Attempts
    Максимальное количество повторов запросов для каждого звонка
	
Equipment. RADIUS Accounting Profiles
-------------------------------
YETI поддерживает аккаунтинг входящих и исходящих звонков на внешнем RADIUS сервере. RADIUS Accounting Profile описывает взаимодействие с таким сервером.

**RADIUS Accounting Profile** атрибуты:

Name
    Название профайла. Используется только как информационное поле и не влияет на работу системы. Название профайла должно быть уникально.
Server
    IP адрес или Hostname внешнего RADIUS сервера.
Port
    Номер UDP порта, на котором RADIUS сервер ожидает запросы.
Secret
    Пароль для авторизации RADIUS сервера.
Timeout
    Таймаут, по истечении заданного кол-ва миллисекунд будет выполняться повтор радиус запроса.
Attempts
    Максимальное количество повторов запросов для каждого звонка
Enable start accounting
	Если активна, то YETI будет отправлять Start-accounting пакеты на удаленный сервер.
Enable interim accounting
	Если активна, YETI будет отправлять Interim-accounting пакеты на удаленный сервер.
Interim accounting interval
	Значение шага отправки Interim-пакетов на удаленный сервер (секунды).
Enable stop accounting
	Если активна, YETI будет отправлять Stop-accounting пакеты на удаленный сервер.

System. Sensors
---------------
Система поддерживает зеркалирование данных сигнализации и медиа.
Этот функционал может быть использован для законного перехвата.
В настоящее время система поддерживает два метода инкапсуляции:

    - IP-IP tunnel
		Оригинальный пакет будет инкапсулирован в дополнительный заголовок туннелирования IP-IP.
		Этот режим позволяет маршрутизировать зеркалируемый трафик, что особенно полезно, когда
		оборудование в точке назначения не находится в том же широковещательном домене.
    - IP over Ethernet
		В данном режиме оригинальные пакеты будут инкапсулированы напряму в Ethernet фрейм с помощью raw-сокета.
		Используется в случаях, когда оборудование в точке назначение находится в том же самом L2 домене.

Сенсор и уровень его лога может быть выбран в настройках Гейтвея. Настройки Сенсора индивидуальны для легов A и B,
поэтому для зеркалирования обоих легов, Сенсоры должны быть настроены для Гейтвея терминации и оригинации.
